/**!
 * p5.grain
 * 
 * @version 0.4.0
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.4.0";#t;#e;#n;constructor(){this.#t=Math.random,this.#e={frameCount:0},this.#n={frameCount:0,tX_anchor:0,tX:0,tY:0}}setup(t){void 0===t?this.#t=random:"object"==typeof t&&"function"==typeof t.random&&(this.#t=t.random)}granulateSimple(t,e){const n=round(t),i=e||!1;loadPixels();const a=pixelDensity(),r=width*a*4*(height*a);for(let t=0;t<r;t+=4){const e=this.#i(-n,n);pixels[t]=pixels[t]+e,pixels[t+1]=pixels[t+1]+e,pixels[t+2]=pixels[t+2]+e,i&&(pixels[t+3]=pixels[t+3]+e)}updatePixels()}granulateChannels(t,e){const n=round(t),i=e||!1;loadPixels();const a=pixelDensity(),r=width*a*4*(height*a);for(let t=0;t<r;t+=4)pixels[t]=pixels[t]+this.#i(-n,n),pixels[t+1]=pixels[t+1]+this.#i(-n,n),pixels[t+2]=pixels[t+2]+this.#i(-n,n),i&&(pixels[t+3]=pixels[t+3]+this.#i(-n,n));updatePixels()}tinkerPixels(t){loadPixels();const e=pixelDensity(),n=width*e*4*(height*e);for(let e=0;e<n;e+=4)t(e,n);updatePixels()}textureAnimate(t,e){const n=e&&e.atFrame?round(e.atFrame):2;if(this.#e.frameCount+=1,this.#e.frameCount>=n){const n=e&&e.amount?round(e.amount):min(width,height),i=floor(this.#t()*n),a=floor(this.#t()*n),r=`${i}px ${a}px`;t instanceof HTMLElement?t.style.backgroundPosition=r:t instanceof SVGElement?(t.style.top=-a+"px",t.style.left=-i+"px"):t instanceof p5.Element&&t.style("background-position",r),this.#e.frameCount=0}}textureOverlay(t,e){const n=e.context instanceof p5.Graphics,i=e.context?e.context.width:width,a=e.context?e.context.height:height,r=e.mode||MULTIPLY,o=e.reflect||!1,s=e.animate||!1,l=e.animate&&e.animate.atFrame?round(e.animate.atFrame):2,u=e.animate&&e.animate.amount?round(e.animate.amount):min(i,a),m="number"==typeof e.width?e.width:t.width,x="number"==typeof e.height?e.height:t.height;s&&(this.#n.frameCount+=1,this.#n.frameCount>=l&&(this.#n.tX_anchor=-floor(this.#t()*u),this.#n.tY=-floor(this.#t()*u),this.#n.frameCount=0));let h=this.#n.tX_anchor,p=this.#n.tY,c=!0,d=!0;for(blendMode(r);p<a;){for(;h<i;){if(o?(n?e.context.push():push(),c?d?n?e.context.image(t,h,p,m,x):image(t,h,p,m,x):n?(e.context.scale(-1,1),e.context.image(t,-h,p,-m,x)):(scale(-1,1),image(t,-h,p,-m,x)):d?n?(e.context.scale(1,-1),e.context.image(t,h,-p,m,-x)):(scale(1,-1),image(t,h,-p,m,-x)):n?(e.context.scale(-1,-1),e.context.image(t,-h,-p,-m,-x)):(scale(-1,-1),image(t,-h,-p,-m,-x)),n?e.context.pop():pop()):n?e.context.image(t,h,p,m,x):image(t,h,p,m,x),h+=m,h>=i){d=!0,h=this.#n.tX_anchor,p+=x;break}d=!d}c=!c}blendMode(BLEND),n&&e.context.reset()}#i(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(this.#t()*(e-t+1)+t)}}const p5grain=new P5Grain;p5.prototype.granulateSimple=function(t,e){return p5grain.granulateSimple(t,e)},p5.prototype.granulateChannels=function(t,e){return p5grain.granulateChannels(t,e)},p5.prototype.tinkerPixels=function(t){return p5grain.tinkerPixels(t)},p5.prototype.textureAnimate=function(t,e){return p5grain.textureAnimate(t,e)},p5.prototype.textureOverlay=function(t,e){return p5grain.textureOverlay(t,e)};
