/**!
 * p5.grain
 * 
 * @version 0.4.0
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.4.0";#t;#e;#n;constructor(){this.#t=Math.random,this.#e={frameCount:0},this.#n={frameCount:0,tX_anchor:0,tX:0,tY:0}}setup(t){void 0===t?this.#t=random:"object"==typeof t&&"function"==typeof t.random&&(this.#t=t.random)}granulateSimple(t,e){const n=round(t),a=e||!1;loadPixels();const i=pixelDensity(),o=width*i*4*(height*i);for(let t=0;t<o;t+=4){const e=this.#a(-n,n);pixels[t]=pixels[t]+e,pixels[t+1]=pixels[t+1]+e,pixels[t+2]=pixels[t+2]+e,a&&(pixels[t+3]=pixels[t+3]+e)}updatePixels()}granulateChannels(t,e){const n=round(t),a=e||!1;loadPixels();const i=pixelDensity(),o=width*i*4*(height*i);for(let t=0;t<o;t+=4)pixels[t]=pixels[t]+this.#a(-n,n),pixels[t+1]=pixels[t+1]+this.#a(-n,n),pixels[t+2]=pixels[t+2]+this.#a(-n,n),a&&(pixels[t+3]=pixels[t+3]+this.#a(-n,n));updatePixels()}granulateCustom(t){loadPixels();const e=pixelDensity(),n=width*e*4*(height*e);for(let e=0;e<n;e+=4)t(e,n);updatePixels()}textureAnimate(t,e){const n=e&&e.atFrame?round(e.atFrame):2;if(this.#e.frameCount+=1,this.#e.frameCount>=n){const n=e&&e.amount?round(e.amount):min(width,height),a=floor(this.#t()*n),i=floor(this.#t()*n),o=`${a}px ${i}px`;t instanceof HTMLElement?t.style.backgroundPosition=o:t instanceof SVGElement?(t.style.top=-i+"px",t.style.left=-a+"px"):t instanceof p5.Element&&t.style("background-position",o),this.#e.frameCount=0}}textureOverlay(t,e){const n=e.context instanceof p5.Graphics,a=e.context?e.context.width:width,i=e.context?e.context.height:height,o=e.mode||MULTIPLY,r=e.reflect||!1,s=e.animate||!1,l=e.animate&&e.animate.atFrame?round(e.animate.atFrame):2,u=e.animate&&e.animate.amount?round(e.animate.amount):min(a,i),m="number"==typeof e.width?e.width:t.width,h="number"==typeof e.height?e.height:t.height;s&&(this.#n.frameCount+=1,this.#n.frameCount>=l&&(this.#n.tX_anchor=-floor(this.#t()*u),this.#n.tY=-floor(this.#t()*u),this.#n.frameCount=0));let p=this.#n.tX_anchor,x=this.#n.tY,c=!0,d=!0;for(blendMode(o);x<i;){for(;p<a;){if(r?(n?e.context.push():push(),c?d?n?e.context.image(t,p,x,m,h):image(t,p,x,m,h):n?(e.context.scale(-1,1),e.context.image(t,-p,x,-m,h)):(scale(-1,1),image(t,-p,x,-m,h)):d?n?(e.context.scale(1,-1),e.context.image(t,p,-x,m,-h)):(scale(1,-1),image(t,p,-x,m,-h)):n?(e.context.scale(-1,-1),e.context.image(t,-p,-x,-m,-h)):(scale(-1,-1),image(t,-p,-x,-m,-h)),n?e.context.pop():pop()):n?e.context.image(t,p,x,m,h):image(t,p,x,m,h),p+=m,p>=a){d=!0,p=this.#n.tX_anchor,x+=h;break}d=!d}c=!c}blendMode(BLEND),n&&e.context.reset()}#a(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(this.#t()*(e-t+1)+t)}}const p5grain=new P5Grain;p5.prototype.granulateSimple=function(t,e){return p5grain.granulateSimple(t,e)},p5.prototype.granulateChannels=function(t,e){return p5grain.granulateChannels(t,e)},p5.prototype.granulateCustom=function(t){return p5grain.granulateCustom(t)},p5.prototype.textureAnimate=function(t,e){return p5grain.textureAnimate(t,e)},p5.prototype.textureOverlay=function(t,e){return p5grain.textureOverlay(t,e)};
