/**!
 * p5.grain
 * 
 * @version 0.3.1
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.3.1";#e;#t;#n;constructor(){this.#e=Math.random,this.#t={frameCount:0},this.#n={frameCount:0,tX_anchor:0,tX:0,tY:0}}setup(e){void 0===e?this.#e=random:"object"==typeof e&&"function"==typeof e.random&&(this.#e=e.random)}granulateSimple(e,t){round(e);const n=t||!1;loadPixels();const i=pixelDensity(),a=width*i*4*(height*i);for(let t=0;t<a;t+=4){const i=this.#i(-e,e);pixels[t]=pixels[t]+i,pixels[t+1]=pixels[t+1]+i,pixels[t+2]=pixels[t+2]+i,n&&(pixels[t+3]=pixels[t+3]+i)}updatePixels()}granulateChannels(e,t){const n=round(e),i=t||!1;loadPixels();const a=pixelDensity(),r=width*a*4*(height*a);for(let e=0;e<r;e+=4)pixels[e]=pixels[e]+this.#i(-n,n),pixels[e+1]=pixels[e+1]+this.#i(-n,n),pixels[e+2]=pixels[e+2]+this.#i(-n,n),i&&(pixels[e+3]=pixels[e+3]+this.#i(-n,n));updatePixels()}granulateFuzzify(e,t,n){loadPixels();const i=round(e),a=t?round(t):2,r=n||!1,o=pixelDensity(),s=4*width*o,l=4*a+s,u=s*(height*o);for(let e=0;e<u;e+=4)pixels[e+l]&&(pixels[e]=round((pixels[e]+pixels[e+l])/2),pixels[e+1]=round((pixels[e+1]+pixels[e+l+1])/2),pixels[e+2]=round((pixels[e+2]+pixels[e+l+2])/2),r&&(pixels[e+3]=round((pixels[e+3]+pixels[e+l+3])/2))),pixels[e]=pixels[e]+this.#i(-i,i),pixels[e+1]=pixels[e+1]+this.#i(-i,i),pixels[e+2]=pixels[e+2]+this.#i(-i,i),r&&(pixels[e+3]=pixels[e+3]+this.#i(-i,i));updatePixels()}textureAnimate(e,t){const n=t&&t.atFrame?round(t.atFrame):2;if(this.#t.frameCount+=1,this.#t.frameCount>=n){const n=t&&t.amount?round(t.amount):min(width,height),i=floor(this.#e()*n),a=floor(this.#e()*n),r=`${i}px ${a}px`;e instanceof HTMLElement?e.style.backgroundPosition=r:e instanceof SVGElement?(e.style.top=-a+"px",e.style.left=-i+"px"):e instanceof p5.Element&&e.style("background-position",r),this.#t.frameCount=0}}textureOverlay(e,t){const n=t.context instanceof p5.Graphics,i=t.context?t.context.width:width,a=t.context?t.context.height:height,r=t.mode||MULTIPLY,o=t.reflect||!1,s=t.animate||!1,l=t.animate&&t.animate.atFrame?round(t.animate.atFrame):2,u=t.animate&&t.animate.amount?round(t.animate.amount):min(i,a),p="number"==typeof t.width?t.width:e.width,x="number"==typeof t.height?t.height:e.height;s&&(this.#n.frameCount+=1,this.#n.frameCount>=l&&(this.#n.tX_anchor=-floor(this.#e()*u),this.#n.tY=-floor(this.#e()*u),this.#n.frameCount=0));let m=this.#n.tX_anchor,h=this.#n.tY,c=!0,d=!0;for(blendMode(r);h<a;){for(;m<i;){if(o?(n?t.context.push():push(),c?d?n?t.context.image(e,m,h,p,x):image(e,m,h,p,x):n?(t.context.scale(-1,1),t.context.image(e,-m,h,-p,x)):(scale(-1,1),image(e,-m,h,-p,x)):d?n?(t.context.scale(1,-1),t.context.image(e,m,-h,p,-x)):(scale(1,-1),image(e,m,-h,p,-x)):n?(t.context.scale(-1,-1),t.context.image(e,-m,-h,-p,-x)):(scale(-1,-1),image(e,-m,-h,-p,-x)),n?t.context.pop():pop()):n?t.context.image(e,m,h,p,x):image(e,m,h,p,x),m+=p,m>=i){d=!0,m=this.#n.tX_anchor,h+=x;break}d=!d}c=!c}blendMode(BLEND),n&&t.context.reset()}#i(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(this.#e()*(t-e+1)+e)}}const p5grain=new P5Grain;p5.prototype.granulateSimple=function(e,t){return p5grain.granulateSimple(e,t)},p5.prototype.granulateChannels=function(e,t){return p5grain.granulateChannels(e,t)},p5.prototype.granulateFuzzify=function(e,t,n){return p5grain.granulateFuzzify(e,t,n)},p5.prototype.textureAnimate=function(e,t){return p5grain.textureAnimate(e,t)},p5.prototype.textureOverlay=function(e,t){return p5grain.textureOverlay(e,t)};
