/**!
 * p5.grain
 * 
 * @version 0.1.0
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.1.0";ignoreErrors=!1;displayWarnings=!0;_textureAnimate={frameCount:0};_textureOverlay={frameCount:0,tX_anchor:0,tX:0,tY:0};constructor(){this._random=Math.random}setup(e){this._validateParameters("setup",arguments),void 0===e?this._random=random:"object"==typeof e&&("function"==typeof e.random&&(this._random=e.random),"boolean"==typeof e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),"boolean"==typeof e.displayWarnings&&(this.displayWarnings=e.displayWarnings))}granulateSimple(e,t){this._validateParameters("granulateSimple",arguments);const r=round(e),n=t||!1;loadPixels();const a=pixelDensity(),o=width*a*4*(height*a);for(let e=0;e<o;e+=4){const t=this._random(-r,r);pixels[e]=pixels[e]+t,pixels[e+1]=pixels[e+1]+t,pixels[e+2]=pixels[e+2]+t,n&&(pixels[e+3]=pixels[e+3]+t)}updatePixels()}granulateChannels(e,t){this._validateParameters("granulateChannels",arguments);const r=round(e),n=t||!1;loadPixels();const a=pixelDensity(),o=width*a*4*(height*a);for(let e=0;e<o;e+=4)pixels[e]=pixels[e]+this._random(-r,r),pixels[e+1]=pixels[e+1]+this._random(-r,r),pixels[e+2]=pixels[e+2]+this._random(-r,r),n&&(pixels[e+3]=pixels[e+3]+this._random(-r,r));updatePixels()}granulateFuzzify(e,t,r){this._validateParameters("granulateFuzzy",arguments),loadPixels();const n=round(e),a=t?round(t):2,o=r||!1,i=pixelDensity(),s=4*width*i,p=4*a+s,l=s*(height*i);for(let e=0;e<l;e+=4)pixels[e+p]&&(pixels[e]=round((pixels[e]+pixels[e+p])/2),pixels[e+1]=round((pixels[e+1]+pixels[e+p+1])/2),pixels[e+2]=round((pixels[e+2]+pixels[e+p+2])/2),o&&(pixels[e+3]=round((pixels[e+3]+pixels[e+p+3])/2))),pixels[e]=pixels[e]+this._random(-n,n),pixels[e+1]=pixels[e+1]+this._random(-n,n),pixels[e+2]=pixels[e+2]+this._random(-n,n),o&&(pixels[e+3]=pixels[e+3]+this._random(-n,n));updatePixels()}textureAnimate(e,t){this._validateParameters("textureAnimate",arguments);const r=t&&t.atFrame?round(t.atFrame):2;if(this._textureAnimate.frameCount+=1,this._textureAnimate.frameCount>=r){const r=t&&t.amount?round(t.amount):min(width,height),n=`${floor(this._random()*r)}px ${floor(this._random()*r)}px`;if(e instanceof HTMLElement)e.style.backgroundPosition=n;else{if(e instanceof SVGElement)throw new Error("[p5.grain] Animating SVGElement currently unsupported.");e instanceof p5.Element&&e.style("background-position",n)}this._textureAnimate.frameCount=0}}textureOverlay(e,t){this._validateParameters("textureOverlay",arguments);const r=t.context instanceof p5.Graphics,n=t.context?t.context.width:width,a=t.context?t.context.height:height,o=t.mode||MULTIPLY,i=t.reflect||!1,s=t.animate||!1,p=t.animate&&t.animate.atFrame?round(t.animate.atFrame):2,l=t.animate&&t.animate.amount?round(t.animate.amount):min(n,a),u="number"==typeof t.width?t.width:e.width,m="number"==typeof t.height?t.height:e.height;s&&(this._textureOverlay.frameCount+=1,this._textureOverlay.frameCount>=p&&(this._textureOverlay.tX_anchor=-floor(this._random()*l),this._textureOverlay.tY=-floor(this._random()*l),this._textureOverlay.frameCount=0));let d=this._textureOverlay.tX_anchor,h=this._textureOverlay.tY,f=!0,g=!0;for(blendMode(o);h<a;){for(;d<n;){if(i?(r?t.context.push():push(),f?g?r?t.context.image(e,d,h,u,m):image(e,d,h,u,m):r?(t.context.scale(-1,1),t.context.image(e,-d,h,-u,m)):(scale(-1,1),image(e,-d,h,-u,m)):g?r?(t.context.scale(1,-1),t.context.image(e,d,-h,u,-m)):(scale(1,-1),image(e,d,-h,u,-m)):r?(t.context.scale(-1,-1),t.context.image(e,-d,-h,-u,-m)):(scale(-1,-1),image(e,-d,-h,-u,-m)),r?t.context.pop():pop()):r?t.context.image(e,d,h,u,m):image(e,d,h,u,m),d+=u,d>=n){g=!0,d=this._textureOverlay.tX_anchor,h+=m;break}g=!g}f=!f}blendMode(BLEND),r&&t.context.reset()}_validateParameters(e,t){if(!this.ignoreErrors)switch(e){case"setup":if(void 0!==t[0]&&"object"!=typeof t[0])throw new Error(`[p5.grain] The optional config parameter passed to p5grain.${e}() must be of type object.`);if("object"==typeof t[0]){if(void 0!==t[0].random&&"function"!=typeof t[0].random)throw new Error(`[p5.grain] The optional config.random property passed to p5grain.${e}() must be of type function.`);if(void 0!==t[0].ignoreErrors&&"boolean"!=typeof t[0].ignoreErrors)throw new Error(`[p5.grain] The optional config.ignoreErrors property passed to p5grain.${e}() must be of type boolean.`);if(void 0!==t[0].displayWarnings&&"boolean"!=typeof t[0].displayWarnings)throw new Error(`[p5.grain] The optional config.displayWarnings property passed to p5grain.${e}() must be of type boolean.`)}break;case"granulateSimple":case"granulateChannels":if("number"!=typeof t[0])throw new Error(`[p5.grain] The amount parameter passed to ${e}() must be of type number.`);if(void 0!==t[1]&&"boolean"!=typeof t[1])throw new Error(`[p5.grain] The alpha parameter passed to ${e}() must be of type boolean.`);break;case"granulateFuzzify":if("number"!=typeof t[0])throw new Error(`[p5.grain] The amount parameter passed to ${e}() must be of type number.`);if(void 0!==t[1]&&"number"!=typeof t[1])throw new Error(`[p5.grain] The fuzziness parameter passed to ${e}() must be of type number.`);if(void 0!==t[2]&&"boolean"!=typeof t[2])throw new Error(`[p5.grain] The alpha parameter passed to ${e}() must be of type boolean.`);break;case"textureAnimate":if(!(t[0]instanceof HTMLElement||t[0]instanceof SVGElement||t[0]instanceof p5.Element))throw new Error(`[p5.grain] The textureElement parameter passed to ${e}() must be an instance of HTMLElement, SVGElement or p5.Element.`);if(void 0!==t[1]&&"object"!=typeof t[1])throw new Error(`[p5.grain] The optional config parameter passed to ${e}() must be of type object.`);if("object"==typeof t[1]){if(void 0!==t[1].atFrame&&"number"!=typeof t[1].atFrame)throw new Error(`[p5.grain] The optional config.atFrame property passed to ${e}() must be of type number.`);if(void 0!==t[1].amount&&"number"!=typeof t[1].amount)throw new Error(`[p5.grain] The optional config.amount parameter passed to ${e}() must be of type number.`)}break;case"textureOverlay":if(!(t[0]instanceof p5.Image))throw new Error(`[p5.grain] The texture parameter passed to ${e}() must be an instance of p5.Image.`);if(void 0!==t[1]&&"object"!=typeof t[1])throw new Error(`[p5.grain] The optional config parameter passed to ${e}() must be of type object.`);if("object"==typeof t[1]){if(void 0!==t[1].width&&"number"!=typeof t[1].width)throw new Error(`[p5.grain] The optional config.width property passed to ${e}() must be of type number.`);if(void 0!==t[1].height&&"number"!=typeof t[1].height)throw new Error(`[p5.grain] The optional config.height property passed to ${e}() must be of type number.`);if(void 0!==t[1].mode&&"string"!=typeof t[1].mode)throw new Error(`[p5.grain] The optional config.mode property passed to ${e}() must be of type string.`);if(void 0!==t[1].context&&!(t[1].context instanceof p5.Graphics))throw new Error(`[p5.grain] The optional config.context parameter passed to ${e}() must be an instance of p5.Graphics.`);if(void 0!==t[1].reflect&&"boolean"!=typeof t[1].reflect)throw new Error(`[p5.grain] The optional config.reflect property passed to ${e}() must be of type boolean.`)}}}}const p5grain=new P5Grain;p5.prototype.hasOwnProperty("granulateSimple")?p5grain.displayWarnings&&console.warn("[p5.grain] granulateSimple() could not be registered, since it's already defined.\nUse p5grain.granulateSimple() instead."):p5.prototype.granulateSimple=function(e,t){return p5grain.granulateSimple(e,t)},p5.prototype.hasOwnProperty("granulateChannels")?p5grain.displayWarnings&&console.warn("[p5.grain] granulateChannels() could not be registered, since it's already defined.\nUse p5grain.granulateChannels() instead."):p5.prototype.granulateChannels=function(e,t){return p5grain.granulateChannels(e,t)},p5.prototype.hasOwnProperty("granulateFuzzify")?p5grain.displayWarnings&&console.warn("[p5.grain] granulateFuzzify() could not be registered, since it's already defined.\nUse p5grain.granulateFuzzify() instead."):p5.prototype.granulateFuzzify=function(e,t,r){return p5grain.granulateFuzzify(e,t,r)},p5.prototype.hasOwnProperty("textureAnimate")?p5grain.displayWarnings&&console.warn("[p5.grain] textureAnimate() could not be registered, since it's already defined.\nUse p5grain.textureAnimate() instead."):p5.prototype.textureAnimate=function(e,t,r){return p5grain.textureAnimate(e,t,r)},p5.prototype.hasOwnProperty("textureOverlay")?p5grain.displayWarnings&&console.warn("[p5.grain] textureOverlay() could not be registered, since it's already defined.\nUse p5grain.textureOverlay() instead."):p5.prototype.textureOverlay=function(e,t){return p5grain.textureOverlay(e,t)};
